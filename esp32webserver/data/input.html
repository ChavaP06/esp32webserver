<!DOCTYPE html>
<html>

<head>
    <title>ESP32 Web Server</title>

    <script>
        (function () {

            initScript().then(function (v) {
                console.info(v);
                var script = document.getElementById("__jquery");
                script.onload = function () {
                    $(document).ready(function () {
                        // Main logic goes here.

                        //////////////////////////////////////On Start Up/////////////////////////////////////////

                        ////sidenav bar////
                        var wifisettingBtn = $('#wifiSettings')
                        var portsettingBtn = $('#portSettings')
                        var mainSettingBtn = $('#mainSettings')
                        var mqttSettingBtn = $('#mqttSettings')
                        var wifiSettingContent = $('#wifiSettingsContent')
                        var portSettingContent = $('#portSettingsContent')
                        var mainSettingContent = $('#mainSettingsContent')
                        var mqttSettingContent = $('#mqttSettingsContent')

                        wifiSettingContent.show()
                        portSettingContent.hide()
                        mainSettingContent.hide()
                        mqttSettingContent.hide()
                        //////////////////

                        ////variables/////
                        var rowIdx = 0;
                        var addressNumIdx = 0;
                        var isConnected;
                        var isMQTTConnected;
                        var modbusData = [];
                        const modbusDataLimit = 63;
                        var defaultBtnColor = 'rgb(230,230,230)'
                        ///////////////////



                        ///////////////////////////////////////////////////////////////////////////////////////////


                        //////////////////////////////////////sidenav bar/////////////////////////////////////////
                        ///////focus on wifi setting on start/////
                        wifisettingBtn.css('background-color', 'white')
                        portsettingBtn.css('background-color', defaultBtnColor)
                        mqttSettingBtn.css('background-color', defaultBtnColor)
                        mainSettingBtn.css('background-color', defaultBtnColor)
                        ///////////////////////////////////////////

                        wifisettingBtn.click(function () {
                            WifiSettingBtnPress()
                            wifisettingBtn.css('background-color', 'white')
                            portsettingBtn.css('background-color', defaultBtnColor)
                            mqttSettingBtn.css('background-color', defaultBtnColor)
                            mainSettingBtn.css('background-color', defaultBtnColor)
                        })

                        portsettingBtn.click(function () {
                            PortSettingBtnPress()
                            portsettingBtn.css('background-color', 'white')
                            mainSettingBtn.css('background-color', defaultBtnColor)
                            mqttSettingBtn.css('background-color', defaultBtnColor)
                            wifisettingBtn.css('background-color', defaultBtnColor)
                        })

                        mainSettingBtn.click(function () {
                            MainSettingBtnPress()
                            mainSettingBtn.css('background-color', 'white')
                            wifisettingBtn.css('background-color', defaultBtnColor)
                            portsettingBtn.css('background-color', defaultBtnColor)
                            mqttSettingBtn.css('background-color', defaultBtnColor)
                        })

                        mqttSettingBtn.click(function () {
                            MQTTSettingsBtnPress()
                            mqttSettingBtn.css('background-color', 'white')
                            mainSettingBtn.css('background-color', defaultBtnColor)
                            wifisettingBtn.css('background-color', defaultBtnColor)
                            portsettingBtn.css('background-color', defaultBtnColor)
                        })


                        function WifiSettingBtnPress() {
                            wifiSettingContent.show()
                            portSettingContent.hide()
                            mainSettingContent.hide()
                            mqttSettingContent.hide()
                        }
                        function PortSettingBtnPress() {
                            wifiSettingContent.hide()
                            portSettingContent.show()
                            mainSettingContent.hide()
                            mqttSettingContent.hide()
                        }
                        function MainSettingBtnPress() {
                            wifiSettingContent.hide()
                            portSettingContent.hide()
                            mainSettingContent.show()
                            mqttSettingContent.hide()
                        }
                        function MQTTSettingsBtnPress() {
                            wifiSettingContent.hide()
                            portSettingContent.hide()
                            mainSettingContent.hide()
                            mqttSettingContent.show()
                        }

                        ///////////////////////////////////////////////////////////////////////////////////////////


                        ////////////////////////////////main settings///////////////////////////////////////////////

                        //////update button//////////
                        var targetUpdateQuantityForm = $('#updateNumBtn');
                        targetUpdateQuantityForm.submit(function (ev) {
                            $('#updateNumButton').attr('disabled', 'disabled')
                            if ($("#rowNum").val() <= 0 || $("#rowNum").val() > 100 || $("#addressNum").val() <= 0 || $("#addressNum").val() > 100) {
                                alert("Enter an integer between 1-100");
                                $('#updateNumButton').removeAttr('disabled')
                            } else {
                                $.ajax({
                                    type: 'GET',
                                    url: '/getSavedTopic',
                                    success: function (response) {
                                        $('#updateNumButton').removeAttr('disabled')
                                        let text = String(response).split("\n")

                                        // console.log(text)

                                        $('#tbody tr').remove();

                                        rowIdx = $("#rowNum").val();
                                        addressNumIdx = $("#addressNum").val();
                                        rowIdx = Math.min(rowIdx, modbusDataLimit)

                                        if (parseInt(rowIdx) + parseInt(addressNumIdx) - 1 !== '0') {
                                            document.getElementById('showThread').innerHTML =
                                                `<tr>
                                                    <th class="text-center" style="">Destination Device</th>
                                                    <th class="text-center" style="">Topic</th>
                                                    <th class="text-center" style="">Payload</th>
                                                </tr>`
                                        } else {
                                            document.getElementById('showThread').innerHTML = ``
                                        }

                                        if (parseInt(addressNumIdx) == 0) {
                                            $('#tbody tr').remove();
                                        } else {
                                            // Adding a row inside the tbody.
                                            var alarm_list_label_show = false
                                            var mc_status_label_show = false
                                            var date_label_show = false


                                            for (var i = 0; i < rowIdx; i++) {

                                                if (i + parseInt(addressNumIdx) >= 1 && i + parseInt(addressNumIdx) < 31 && alarm_list_label_show == false) {
                                                    alarm_list_label_show = true

                                                    $('#tbody').append(`<tr id="R${i}" class="border">
                                                                            <td colspan="1" class="text-center" style="text-align: center;">
                                    
                                                                                <p style="font-weight: bold;">                                
                                                                                    Alarm List
                                                                                </p>
                                                                            </td>    
                                                                        </tr>`)
                                                } else if (i + parseInt(addressNumIdx) >= 31 && i + parseInt(addressNumIdx) < 41 && mc_status_label_show == false) {
                                                    mc_status_label_show = true
                                                    $('#tbody').append(`<tr id="R${i}" class="border">
                                                                            <td colspan="1" class="text-center" style="text-align: center;">
                                    
                                                                                <p style="font-weight: bold;">                                
                                                                                    MC Status
                                                                                </p>
                                                                            </td>    
                                                                        </tr>`)
                                                } else if (i + parseInt(addressNumIdx) >= 41 && date_label_show == false) {
                                                    date_label_show = true
                                                    $('#tbody').append(`<tr id="R${i}" class="border">
                                                                            <td colspan="1" class="text-center" style="text-align: center;">
                                    
                                                                                <p style="font-weight: bold;">                                
                                                                                    Date
                                                                                </p>
                                                                            </td>    
                                                                        </tr>`)
                                                }
                                                if ((i + parseInt(addressNumIdx) <= modbusDataLimit)) {
                                                    $('#tbody').append(`<tr id="R${i}">
                                                                            <td class="text-center" style="text-align: center;">
                                                                                <p>                                
                                                                                <!-- <select name="destdevice" id="destdevice${i}" class="btn btn-light border" style="text-align : center;" ">
                                                                                    <option value="${String(i + parseInt(addressNumIdx) + 400000)}">${String(i + parseInt(addressNumIdx) + 400000)}</option>
                                                                                    <option value="${padWithLeadingZeros(i + parseInt(addressNumIdx) + 000000, 6)}">${padWithLeadingZeros(i + parseInt(addressNumIdx) + 000000, 6)}</option>
                                                                                    </select>-->
                                                                                    ${GetValue(i, addressNumIdx, rowIdx)}
                                                                                </p>
                                                                            </td>    
    
                                                                            <td class="row-index text-center" style="text-align: center;">
                                                                                <input type="text" name="inputReg${i}" id="inputReg${i}"class="form-control col-sm-4 text-center" style="display:inline-block;" value="${text[parseInt(addressNumIdx) + i - 1]}">
                                                                            <!--<p>Row ${i}</p>-->
                                                                            </td>
                                                                            <td class="text-center" style="text-align: center;">
                                                                                <p id="busData${i}"></p>
                                                                            </td>    
                                                                            <!--<td class="text-center">
                                                                            <input type="text" name="inputVal${i}">
                                                                            </td>-->

                                                                            set  <!--<td class="text-center">
                                                                            <button class="btn btn-danger remove" type="button">Remove</button>
                                                                            </td>-->
                                                                        </tr>`);

                                                }

                                            }


                                        }

                                        if (parseInt(rowIdx) + parseInt(addressNumIdx) - 1 > 0 && parseInt(addressNumIdx) != 0) {
                                            var urlWithParams = targetUpdateQuantityForm.attr('action') + "?" + targetUpdateQuantityForm.serialize();
                                            $.ajax({
                                                type: 'POST',
                                                url: urlWithParams + "rowNum=" + rowIdx + "&addressNumIdx=" + addressNumIdx,
                                                success: function (response) {

                                                }
                                            })
                                        }

                                    }

                                })
                            }


                            ev.preventDefault();

                        })
                        /////////////////////////

                        //////modbus poll//////////
                        var targetDataPoll = $('#modbusPoll');
                        targetDataPoll.submit(function (ev) {

                            var urlWithParams = targetDataPoll.attr('action') + "?" + targetDataPoll.serialize();
                            $.ajax({
                                type: 'GET',
                                url: urlWithParams + "&addressNum=" + addressNumIdx + "&rowIdx=" + rowIdx,
                                success: function (response) {
                                    let text = String(response).split("\n")
                                    if (text.length !== 1) {
                                        text.pop();
                                    }



                                    modbusData = text
                                    console.log(modbusData)


                                    if (modbusData[modbusData.length - 2] == "1") {
                                        isMQTTConnected = true
                                    } else {
                                        isMQTTConnected = false
                                    }

                                    var mqttStatusText = $('#mqtt_status_text')

                                    if (isMQTTConnected) {

                                        mqttStatusText.attr("style", "font-weight:bold;color:green;")
                                        mqttStatusText.html('Connected')

                                    } else {
                                        mqttStatusText.attr("style", "font-weight:bold;color:red;")
                                        mqttStatusText.html('Disconnected')
                                    }



                                    isConnected = modbusData[modbusData.length - 1]

                                }
                            })

                            if (rowIdx == 0) {
                                if (isConnected == 0) {
                                    document.getElementById('connectionStatus').innerHTML = 'Modbus Disconnected.'
                                } else {
                                    document.getElementById('connectionStatus').innerHTML = ''
                                }
                            }


                            for (let i = 0; i < rowIdx; i++) {
                                if (i + parseInt(addressNumIdx) <= modbusDataLimit) {
                                    if (parseInt(rowIdx) + parseInt(addressNumIdx) - 1 > 0 && parseInt(addressNumIdx) != 0) {
                                        if (!isNaN(parseInt(modbusData[i])))

                                            document.getElementById(`busData${i}`).innerHTML = modbusData[i]
                                        else {
                                            if (i + addressNumIdx < 41) {
                                                document.getElementById(`busData${i}`).innerHTML = '0'
                                            } else {
                                                document.getElementById(`busData${i}`).innerHTML = 'Polling...'
                                            }

                                        }

                                        if (isConnected == 0) {
                                            document.getElementById(`busData${i}`).innerHTML = 'Polling...'
                                            document.getElementById('connectionStatus').innerHTML = 'Modbus Disconnected.'
                                        } else {
                                            document.getElementById('connectionStatus').innerHTML = ''
                                        }
                                    }
                                } else {
                                    // document.getElementById(`busData${i}`).innerHTML = 'test'
                                }




                            }

                            ev.preventDefault();
                        })


                        //console.log(isConnected)




                        var targetStatusPoll = $('#modbusStatus');
                        targetStatusPoll.submit(function (ev) {
                            var urlWithParams = targetStatusPoll.attr('action') + "?" + targetStatusPoll.serialize()
                            $.ajax({
                                type: 'GET',
                                url: urlWithParams,
                                success: function (response) {
                                    console.log(response)
                                }
                            })
                            ev.preventDefault();
                        })


                        setInterval(ajaxCall, 800);
                        function ajaxCall() {
                            $('#modbusPoll').submit();
                            // GetMQTTStatus();
                        }
                        /////////////////////////////


                        ////////////////TOPIC SAVING//////////////
                        var saveTopicForm = $('#savetopic')
                        saveTopicForm.submit(function (ev) {
                            $('#savetopicbutton').attr('disabled', 'disabled')
                            let saveTopicUrl = "/saveTopic?"
                            for (let i = 0; i < rowIdx; i++) {
                                // console.log($(`#inputReg${i}`).val())
                                if (i == 0) {
                                    saveTopicUrl = saveTopicUrl + `inputReg${i}` + "=" + $(`#inputReg${i}`).val()
                                } else {
                                    saveTopicUrl = saveTopicUrl + "&" + `inputReg${i}` + "=" + $(`#inputReg${i}`).val()
                                }


                            }
                            // console.log(saveTopicUrl)

                            $.ajax({
                                type: 'GET',
                                url: saveTopicUrl,
                                success: function (response) {
                                    alert('Topic saved successfully.')
                                    $('#savetopicbutton').removeAttr('disabled')
                                }
                            });

                            ev.preventDefault()
                        })
                        //////////////////////////////////////////






                        ///////////////////////////////////////////////////////////////////////////////////////////

                        ////////////////////////////////////////////Usable functions///////////////////////////////
                        function GetValue(index, address, rowidx) {
                            // alert(addressNumIdx + index + rowIdx)
                            // console.log(document.getElementById('destdevice').innerHTML)
                            var num = parseInt(index) + parseInt(address)
                            //console.log(parseInt(index) + parseInt(address))
                            if (num >= 0 && num < 31) {
                                return (padWithLeadingZeros(parseInt(index) + parseInt(address) + 000000, 6))
                            } else if (num >= 31 && num < 41) {
                                return (padWithLeadingZeros(parseInt(index) + parseInt(address) + 000000, 6))
                            } else if (num >= 41) {
                                return (parseInt(index) + parseInt(address) + 400000)
                            } else {
                                return (parseInt(index) + parseInt(address) + 400000)
                            }



                        }
                        function padWithLeadingZeros(num, totalLength) {
                            return String(num).padStart(totalLength, '0')
                        }


                        ///////////////////////////////////////////////////////////////////////////////////////////
                        ///////////////////////////RESET BUTTON////////////////////////////////////////////////////

                        $('#resetBtnPress').on('click', function (ev) {
                            // $('#resetBtnPress').css('background-color','white')
                            let text = "Are you sure?\nAll settings and saved data will be reset.";
                            if (confirm(text) == true) {

                                $.ajax({
                                    type: 'POST',
                                    url: '/resetESP32',
                                    success: function (response) {
                                        document.getElementsByTagName('body')[0].innerHTML = response;
                                    }
                                });


                                ev.preventDefault();
                            }
                        })



                        var targetResetForm = $('#confirmResetBtn');
                        targetResetForm.submit(function (ev) {

                            var urlWithParams = targetResetForm.attr('action') + "?" + targetResetForm.serialize();
                            $.ajax({
                                type: 'POST',
                                url: urlWithParams,
                                success: function (response) {
                                    document.getElementsByTagName('body')[0].innerHTML = response;
                                }
                            });

                            console.log(urlWithParams);
                            ev.preventDefault();

                        });
                        ///////////////////////////////////////////////////////////////////////////////////////////






                        /////////////////////////////////////ON WINDOW LOAD////////////////////////////////////////
                        $(window).on('load', function () {
                            var hostname = ""

                            function checkEmptyHostName() {
                                try {
                                    if (!document.getElementById('mainSettingHostName').innerHTML) {
                                        window.setTimeout(checkEmptyHostName, 1000)
                                    }
                                } catch {
                                    window.setTimeout(checkEmptyHostName, 1000)
                                }

                            }

                            checkEmptyHostName()

                            $.ajax({
                                type: 'GET',
                                url: '/getHostname',
                                success: function (response) {
                                    //console.log(response)
                                    hostname = response
                                    try {
                                        if (hostname)
                                            document.getElementById('mainSettingHostName').innerHTML = "&nbsp;" + (hostname + " SETTINGS").toUpperCase()
                                    } catch {
                                        window.setTimeout(checkEmptyHostName, 1000)
                                    }


                                }
                            })
                        })
                        ///////////////////////////////////////////////////////////////////////////////////////////
                        /////////////////////////////////port settings/////////////////////////////////////////////
                        var targetSettingForm = $('#mysettings');
                        targetSettingForm.submit(function (ev) {
                            $('#mysettingsbtn').attr('disabled', 'disabled')
                            var urlWithParams = targetSettingForm.attr('action') + "?" + targetSettingForm.serialize();
                            $.ajax({
                                type: 'POST',
                                url: urlWithParams,
                                success: function (response) {
                                    alert('Ok!')
                                    $('#mysettingsbtn').removeAttr('disabled')
                                }
                            });

                            console.log(urlWithParams);
                            ev.preventDefault();
                        });

                        $.ajax({
                            type: 'GET',
                            url: '/getSettings',
                            success: function (response) {
                                let text = String(response).split("\n")
                                console.log(text)
                                document.getElementById('port').value = text[0]
                                document.getElementById('modbus').value = text[1]
                                document.getElementById('baud').value = text[2]
                                document.getElementById('databit').value = text[3]
                                document.getElementById('stopbit').value = text[4]
                                document.getElementById('parity').value = text[5]
                                document.getElementById('timeoutTime').value = text[6]
                                document.getElementById('modbusAddress').value = text[7]

                                if (document.getElementById('modbus').value == 'slave') {
                                    document.getElementById('timeoutTimeLabel').innerHTML = 'Delay Time(ms)'
                                    document.getElementById('modbusAddressLabel').innerHTML = 'Slave Address'
                                } else {
                                    document.getElementById('timeoutTimeLabel').innerHTML = 'Timeout Time(ms)'
                                    document.getElementById('modbusAddressLabel').innerHTML = 'Host Address'
                                }
                            }
                        })



                        $('select[name="modbus"]').change(function () {

                            if ($('#modbus').val() == 'slave') {
                                // document.getElementById('tbodyport').innerHTML = ;

                                document.getElementById('timeoutTimeLabel').innerHTML = 'Delay Time(ms)'
                                document.getElementById('modbusAddressLabel').innerHTML = 'Slave Address'

                            } else {
                                // document.getElementById('tbodyport').innerHTML = ;
                                document.getElementById('timeoutTimeLabel').innerHTML = 'Timeout Time(ms)'
                                document.getElementById('modbusAddressLabel').innerHTML = 'Host Address'
                            }
                        });
                        ///////////////////////////////////////////////////////////////////////////////////////////
                        //////////////////////////////////wifi settings////////////////////////////////////////////
                        $.ajax({
                            type: 'GET',
                            url: '/getWiFiSettings',
                            success: function (response) {
                                let text = String(response).split("\n")
                                document.getElementById('ssid').value = text[0]
                                document.getElementById('pass').value = text[1]
                                document.getElementById('hostname').value = text[2]
                                document.getElementById('ip').value = text[3]
                                if (text[4] && text[5]) {
                                    document.getElementById('gateway').value = text[4]
                                    document.getElementById('subnetString').value = text[5]
                                }

                                //console.log(response)

                            }
                        });


                        var targetSettingFormWiFi = $('#wifisetup');
                        targetSettingFormWiFi.submit(function (ev) {
                            if ($('#ssid').val() == ""
                                || $('#pass').val() == ""
                                || $('#hostname').val() == ""
                                // || $('#mqttserver').val() == ""
                                // || $('#mqttport').val() == ""
                                || $('#ip').val() == ""
                                || $('#gateway').val() == ""
                                || $('#subnetString').val() == "") {
                                alert("Please type input correctly.")
                                ev.preventDefault()
                                return
                            }

                            // if (isNaN(parseInt($('#mqttport').val()))) {
                            //     alert("Mqtt broker port must be a number.")
                            //     ev.preventDefault()
                            //     return
                            // }

                            var urlWithParams = targetSettingFormWiFi.attr('action') + "?" + targetSettingFormWiFi.serialize();
                            // console.log(urlWithParams)
                            // console.log(window.location.search) 
                            function getUrlVars() {
                                var vars = {};
                                var parts = urlWithParams.replace(/[?&]+([^=&]+)=([^&]*)/gi,
                                    function (m, key, value) {
                                        vars[key] = value;
                                    });
                                return vars;
                            }
                            var params = getUrlVars()

                            // console.log(params['ip'])
                            var checkURL = "/checkIP?ip=" + params['ip'] + `&ssid=${params['ssid']}` + `&pass=${params['pass']}` + `&hostname=${params['hostname']}`
                            $('#setwifisubmitbtn').attr("disabled", "disabled")


                            // console.log(checkURL)
                            let ipcheck = $.ajax({
                                type: 'POST',
                                url: checkURL,
                                success: function (response) {

                                    if (response == 'Ok!') {

                                        $.ajax({
                                            type: 'POST',
                                            url: urlWithParams,
                                            success: function (response) {
                                                document.getElementsByTagName('body')[0].innerHTML = response;
                                            }
                                        });

                                    } else {
                                        alert(response)
                                    }


                                    $('#setwifisubmitbtn').removeAttr('disabled')


                                }
                            });


                            ev.preventDefault();

                        });
                        ///////////////////////////////////////////////////////////////////////////////////////////
                        //////////////////////////////////////MQTT SETTINGS////////////////////////////////////////

                        $.ajax({
                            type: 'GET',
                            url: '/getMQTTSettings',
                            success: function (response) {
                                let text = String(response).split("\n")
                                $('#mqttaddress').val(`${text[0]}`)
                                $('#mqttport').val(`${text[1]}`)
                                $('#mqttinterval').val(`${text[2]}`)
                                if (text[3] == "true") {
                                    $('#mqttenable').prop('checked', true)
                                } else {
                                    $('#mqttenable').prop('checked', false)
                                }



                            }
                        });

                        function GetMQTTStatus() {
                            $.ajax({
                                type: 'GET',
                                url: '/getMQTTStatus',
                                success: function (response) {
                                    var mqttStatusText = $('#mqtt_status_text')

                                    if (response == "1") {
                                        isMQTTConnected = true
                                    } else {
                                        isMQTTConnected = false
                                    }
                                    //alert(response)
                                    if (isMQTTConnected) {

                                        mqttStatusText.attr("style", "font-weight:bold;color:green;")
                                        mqttStatusText.html('Connected')

                                    } else {
                                        mqttStatusText.attr("style", "font-weight:bold;color:red;")
                                        mqttStatusText.html('Disconnected')
                                    }
                                }
                            });
                        }




                        var targetSettingFormMQTT = $('#mqttsetup');
                        targetSettingFormMQTT.submit(function (ev) {
                            $('#mqttsetupbtn').attr('disabled', 'disabled')

                            // var mqtt_enable_checked = $('#mqttenable').is(':checked')
                            // alert(mqtt_enable_checked)
                            let mqttaddress = $('#mqttaddress').val()
                            let mqttport = $('#mqttport').val()
                            let mqttinterval = $('#mqttinterval').val()
                            let mqttenable = String($('#mqttenable').is(':checked'))
                            // alert(mqttaddress + ' ' + mqttport + ' ' + mqttinterval + ' ' + mqttenable)

                            var mqttURL = `/setMQTTSettings?mqttaddress=${mqttaddress}&mqttport=${mqttport}&mqttinterval=${mqttinterval}&mqttenable=${mqttenable}`
                            $.ajax({
                                type: 'GET',
                                url: mqttURL,
                                success: function (response) {
                                    alert(response)
                                    $('#mqttsetupbtn').removeAttr('disabled')

                                }
                            })


                            ev.preventDefault()
                        })
                        ///////////////////////////////////////////////////////////////////////////////////////////


                    });
                };
            });

            function initScript() {
                promise = new Promise(function (resolve, reject) {
                    try {
                        if (typeof jQuery == 'undefined') {
                            console.warn("jQuery doesn't exists");
                            var jQuery_script = document.createElement("script");
                            jQuery_script.src = "jquery.min.js";
                            jQuery_script.type = 'text/javascript';
                            jQuery_script.id = "__jquery";
                            document.head.appendChild(jQuery_script);
                            resolve("jQuery added succesfully.");
                        }
                        resolve("jQuery exists.")
                    } catch (ex) {
                        reject("Something went wrong on initScript() : ", ex);
                    }
                });
                return promise;
            }

        })();

    </script>

    <link rel="stylesheet" type="text/css" href="bootstrap.min.css">
    <!-- <script src="jquery"></script> -->
    <!-- <script src="jquery.min.js"></script> -->
    <!-- <script src="bootstrap"></script> -->
    <script src="bootstrap.min.js"></script>


    <!-- <script>
        $(document).ready(function () {

        })

    </script> -->


    <style>
        .sidenav {
            width: 130px;
            position: fixed;
            z-index: 1;
            top: 20px;
            left: 10px;
            background: #ffffff;
            overflow-x: hidden;
            padding: 0px 30px;

        }


        .sidenav a:hover {
            color: #064579;
        }

        .main {
            margin-left: 140px;
            /* Same width as the sidebar + left position in px */
            /*font-size: 28px; /* Increased text to enable scrolling */
            padding: 0px 0px;
        }

        .button:hover {
            background-color: white;
        }

        .button {
            background-color: rgb(230, 230, 230);
        }

        /* @media screen and (max-height: 600px) {
            .sidenav {
                padding-top: 15px;
            }

            .sidenav a {
                font-size: 18px;
            } */
        /* } */
    </style>


</head>

<body>




    <div class="sidenav">
        <div>
            <p
                style="border-color: rgb(0, 0, 0);border: black; border-width: 0px; border-radius: 0px;border-style: solid;text-align: center;margin-bottom: 0px;font-weight: bold;background-color: rgb(151, 151, 151);color: white;padding-top: 8px;padding-bottom: 8px;">
                Settings</p>

            <button type="button" id="wifiSettings"
                style="width: 70px;border: lightgray;border-style: solid;border-width: 1px;padding-top: 3px;padding-bottom: 3px;"
                class="button">WiFi</button>
            <button type="button" id="portSettings"
                style="width: 70px;border: lightgray;border-style: solid;border-width: 1px;padding-top: 3px;padding-bottom: 3px;"
                class="button">Port</button>
            <button type="button" id="mainSettings"
                style="width: 70px;border: lightgray;border-style: solid;border-width: 1px;padding-top: 3px;padding-bottom: 3px;"
                class="button">Main</button>
            <button type="button" id="mqttSettings"
                style="width: 70px;border: lightgray;border-style: solid;border-width: 1px;padding-top: 3px;padding-bottom: 3px;"
                class="button">MQTT</button>
            <button type="button" data-toggle="modal" data-target="#exampleModal"
                style="margin-top: 200%;width: 70px;border: lightgray;border-style: solid;border-width: 1px;border-radius: 2px;"
                id="resetBtnPress" class="button">Reset ESP32</button>
        </div>

    </div>

    <div class="main">

        <div id="mainSettingsContent">

            <h2 style="background-color: #3372a5;color: white;line-height: 50px;" id="mainSettingHostName">&nbsp;MAIN
                SETTINGS</h2>

            <div class="table-responsive" id="tableDiv">
                <form action="/setModbusQuantity" id="updateNumBtn" method="post">

                    <input type="submit" class="btn btn-md btn-primary" value="Update" id="updateNumButton"
                        style="margin-bottom: 5px;float: right;">
                </form>

                <form class="form-anticlear" id="myform" action="/get" method="get">
                    <b style="color: red;" id="connectionStatus">Modbus Disconnected</b>



                    <input type="number" id="rowNum" name="rowNum" value=0 min=0 style="float: right;">
                    <p style="font-weight: bold;float: right;margin-top: 5px;">Quantity</p>
                    <input type="number" id="addressNum" name="addressNum" value=0 min=0 style="float: right;">
                    <p style="font-weight: bold;float: right;margin-top: 5px;;">Address</p>



                    <table class="table table-bordered" style="margin: 0 auto;">
                        <thead id="showThread">
                            <!-- <tr>
                                <th class="text-center" style="">No.</th>
                                <th class="text-center" style="">Register</th>
                            </tr> -->
                        </thead>

                        <tbody id="tbody">

                            <!-- Create Table -->

                        </tbody>

                    </table>
                    <br>
                    <input type="hidden" class="btn btn-md btn-primary" value="Send MQTT" style="float:right">
                </form>

                <form class="form-anticlear" id="modbusPoll" action="/getModbusData" method="get">
                    <input type="submit" class="btn btn-md btn-danger" value="Submit"
                        style="float:right; visibility: hidden;">
                </form>

                <form class="form-anticlear" id="modbusStatus" action="/getConnectedStatus" method="get">
                    <input type="submit" class="btn btn-md btn-danger" value="Submit"
                        style="float:right; visibility: hidden;">
                </form>
                <form id="savetopic" action="/saveTopic" method="get">
                    <input type="submit" class="btn btn-md btn-primary" id="savetopicbutton" value="Save Topic"
                        style="margin-bottom: 20px;">
                </form>
            </div>
        </div>

        <div id="portSettingsContent">

            <h2 style="background-color: #3372a5;color: white;line-height: 50px;">&nbsp;PORT SETTINGS</h2>
            <form action="/set" class="form-anticlear" method="post" id="mysettings">

                <div style="display:block;text-align: right;">
                    <b>Port</b>
                    <select name="port" id="port" class="form-control" style="display:inline-block;width: 100px;">
                        <option value="rs232">RS232</option>
                        <option value="ethernet">Ethernet</option>

                    </select>


                    <b>Modbus</b>
                    <select name="modbus" id="modbus" class="form-control" style="display:inline-block;width: 100px;">
                        <option value="master">Master</option>
                        <option value="slave">Slave</option>

                    </select>


                </div>
                <div class="table-responsive" style="margin-left: auto; margin-right: auto;">
                    <table class="table table-bordered" style=" margin: 0 auto;">
                        <thead>
                            <tr>
                                <th class="text-center" style="">Setting</th>
                                <th class="text-center" style="">Select...</th>
                            </tr>
                        </thead>

                        <tbody id="tbodyport">

                            <!-- Create Table -->
                            <tr id="rp1">
                                <td class="text-center" style="">
                                    <p>Tranmission Speed</p>
                                </td>

                                <td class="row-index text-center" style="">
                                    <select name="baud" id="baud" style="text-align: center;" class="form-control">
                                        <option value="9600">9600</option>
                                        <option value="19200">19200</option>
                                        <option value="38400">38400</option>
                                        <option value="57600">57600</option>
                                        <option value="115200">115200</option>
                                    </select>
                                    <!--<p>Row ${i}</p>-->
                                </td>
                            <tr id="rp1">
                                <td class="text-center" style="">
                                    <p>Data Bit</p>
                                </td>

                                <td class="row-index text-center" style="">
                                    <select name="databit" id="databit" style="text-align: center;"
                                        class="form-control">
                                        <option value="7bit">7 bit</option>
                                        <option value="8bit" selected="selected">8 bit</option>

                                    </select>
                                    <!--<p>Row ${i}</p>-->
                                </td>
                            <tr id="rp1">
                                <td class="text-center" style="">
                                    <p>Stop Bit</p>
                                </td>

                                <td class="row-index text-center" style="">
                                    <select name="stopbit" id="stopbit" style="text-align: center;"
                                        class="form-control">
                                        <option value="1bit">1 bit</option>
                                        <option value="2bit">2 bit</option>
                                    </select>
                                    <!--<p>Row $
                                                {i}</p>-->
                                </td>
                            <tr id="rp1">
                                <td class="text-center" style="">
                                    <p>Parity</p>
                                </td>

                                <td class="row-index text-center" style="">
                                    <select name="parity" id="parity" style="text-align: center;" class="form-control">
                                        <option value="none">None</option>
                                        <option value="even">Even</option>
                                        <option value="odd">Odd</option>
                                    </select>
                                    <!--<p>Row ${i}</p>-->
                                </td>
                            <tr id="rp1">
                                <td class="text-center" style="">
                                    <p id="timeoutTimeLabel">Timeout Time(ms)</p>
                                </td>

                                <td class="row-index text-center" style="">
                                    <input type="number" id="timeoutTime" name="timeoutTime" class="form-control"
                                        style="text-align: center">
                                    <!--<p>Row ${i}</p>-->
                                </td>
                                <!--<td class="text-center">
                                    <input type="text" name="inputVal${i}">
                                </td>-->
                            <tr id="rp1">
                                <td class="text-center" style="" id="hostaddress">
                                    <p id="modbusAddressLabel">Host Address</p>
                                </td>

                                <td class="row-index text-center" style="">
                                    <input type="number" id="modbusAddress" name="modbusAddress" value="1"
                                        class="form-control" style="text-align: center">
                                    <!--<p>Row ${i}</p>-->
                                </td>



                        </tbody>

                    </table>


                    </tr>
                    <!-- <input type="number" id="slaveID" name="slaveID" value=0 min=0> -->
                </div>
                <input input type="submit" class="btn btn-md btn-primary" id="mysettingsbtn" value="Submit"
                    style="float:right;margin-top: 12px;margin-right: 12px">
            </form>
        </div>

        <div id="wifiSettingsContent">

            <h2 style="background-color: #3372a5;color: white;line-height: 50px;">&nbsp;ESP32 WI-FI MANAGER</h2>

            <div class="content">

                <form action="/setwifi" method="post" id="wifisetup" style="">
                    <p style="width: 800px;margin-left: auto; margin-right: auto;">
                        <label for="ssid" style="font-weight: bold;">SSID</label>
                        <input type="text" id="ssid" name="ssid" class="form-control"><br>
                        <label for="pass" style="font-weight: bold;">Password</label>
                        <input type="password" id="pass" name="pass" class="form-control"><br>
                        <label for="hostname" style="font-weight: bold;">Machine Name</label>
                        <input type="text" id="hostname" name="hostname" class="form-control"><br>
                        <!-- <label for="mqttserver" style="font-weight: bold;">MQTT Broker Address</label>
                        <input type="text" id="mqttserver" name="mqttserver" class="form-control"><br>
                        <label for="mqttport" style="font-weight: bold;">MQTT Broker Port</label>
                        <input type="text" id="mqttport" name="mqttport" class="form-control"><br> -->
                        <!-- <input type="checkbox" id="dhcpchecked" name="dhcpchecked" value="true">
                        <input type="hidden" id="dhcpunchecked" name="dhcpunchecked" value="true">
                        <label><b>DHCP</b></label><br><br> -->

                        <!-- cross and checkmark use to check if ip is used -->
                        <!-- &#10060;&#9989; -->

                        <label for="ip" style="font-weight: bold;" id="ip-label">IP Address</label>
                        <input type="text" id="ip" name="ip" value="192.168.100.143" class="form-control"><br>
                        <label for="gateway" style="font-weight: bold;" id="gateway-label">Default Gateway
                            Address</label>
                        <input type="text" id="gateway" name="gateway" value="192.168.100.1" class="form-control"><br>
                        <label for="subnet" style="font-weight: bold;" id="subnetmask-label">Subnet Mask</label>
                        <input type="text" id="subnetString" name="subnetString" value="255.255.255.0"
                            class="form-control"><br>

                        <input type="submit" value="Submit" class="btn btn-primary" id="setwifisubmitbtn"
                            style="float:right;margin-bottom: 20px;">


                    </p>
                </form>


            </div>

        </div>

        <div id="mqttSettingsContent">
            <h2 style="background-color: #3372a5;color: white;line-height: 50px;">&nbsp;MQTT SETTINGS</h2>
            <div class="content">

                <form action="/setmqtt" method="post" id="mqttsetup" style="">
                    <p style="width: 800px;margin-left: auto; margin-right: auto;">
                        <br><label>MQTT Status : </label>
                        <test id="mqtt_status_text" style=""></test>
                        <br><br>

                        <label for="mqttaddress" style="font-weight: bold;">Set MQTT Address</label>
                        <input type="text" id="mqttaddress" name="mqttaddress" class="form-control"><br>
                        <label for="mqttport" style="font-weight: bold;">Set MQTT Broker Port</label>
                        <input type="text" id="mqttport" name="mqttport" class="form-control"><br>
                        <label for="mqttinterval" style="font-weight: bold;">Data Tranmission Interval (ms)</label>
                        <input type="number" id="mqttinterval" name="mqttinterval" class="form-control"><br>

                        <input type="checkbox" id="mqttenable" name="mqttenable">
                        <label><b>Enable MQTT Data Tranmission</b></label><br><br>

                        <input type="submit" value="Submit" class="btn btn-primary"
                            style="float:right;margin-bottom: 20px;" id="mqttsetupbtn">
                    </p>
                </form>


            </div>

        </div>

    </div>

</body>



</html>